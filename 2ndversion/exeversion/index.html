<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D Array Rendering with WebGL</title>
    <style>
        canvas {
            display: block;
            margin: 0 auto;
            border: 1px solid black;
        }

        .button-container {
            text-align: center;
            margin-top: 20px;
        }

        .button-container button {
            margin: 5px;
        }
    </style>
</head>

<body>
    <canvas id="canvas"></canvas>
    <div class="button-container">
        <button id="button" onclick="startWithNewRules()">generate new</button>
        <button id="button" onclick="step()">evolve</button>
        <button id="button" onclick="initiate()">return to start</button>
        <button id="button" onclick="randomColorAndRender()">random color</button>
    </div>
    <script>
        // Define variables for canvas size and rectangle size

        const rectSize = 8; // Size of each rectangle


        const WIDTH = 64; //ungerade!
        const HEIGHT = 64;

        const canvasWidth = WIDTH * rectSize;
        const canvasHeight = HEIGHT * rectSize;

        // Define your 2D array with values
        const data = new Array(WIDTH, HEIGHT);
        //fill the array with random values
        for (var i = 0; i < WIDTH; i++) {
            data[i] = new Array(HEIGHT);
            for (var j = 0; j < HEIGHT; j++) {
                data[i][j] = 0;
            }
        }
        setStartValues(data);

        const rules = new Array(69);
        const rulesC = new Array(69);
        const colors = new Array(69);

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
        const offsetX = (canvasWidth - (data[0].length * rectSize)) / 2;
        const offsetY = (canvasHeight - (data.length * rectSize)) / 2;



        var ruleSeed = Math.floor(Math.random() * 16777216);
        setRuleSymmetric(ruleSeed);
        setRandomColor();
        // ctx.clearRect(0, 0, canvas.width, canvas.height);
        render(data, colors, offsetX, offsetY, rectSize, ctx);

        var index = 0;

        //--------------------------------------------------------------------------------

        function startWithNewRules() {
            ruleSeed = Math.floor(Math.random() * 16777216);
            setRuleSymmetric(ruleSeed);
            setRandomColor();
            initiate();
            render(data, colors, offsetX, offsetY, rectSize, ctx);
        }


        function initiate() {
            for (var i = 0; i < WIDTH; i++) {
                data[i] = new Array(HEIGHT);
                for (var j = 0; j < HEIGHT; j++) {
                    data[i][j] = 0;
                }
            }
            setStartValues(data);
            //setRuleSymmetric(ruleSeed);
            //setRandomColor();
            // ctx.clearRect(0, 0, canvas.width, canvas.height);
            render(data, colors, offsetX, offsetY, rectSize, ctx);
            var index = 0;

        }

        function setStartValues(data) {
            data[Math.round(WIDTH / 2 - 0.5) - 1][Math.round(HEIGHT / 2 - 0.5)] = 1;
            data[Math.round(WIDTH / 2 - 0.5)][Math.round(HEIGHT / 2 - 0.5) - 1] = 1;
            data[Math.round(WIDTH / 2 - 0.5) + 1][Math.round(HEIGHT / 2 - 0.5)] = 1;
            data[Math.round(WIDTH / 2 - 0.5)][Math.round(HEIGHT / 2 - 0.5) + 1] = 1;
        }


        function step() {
            nextStep(data);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            render(data, colors, offsetX, offsetY, rectSize, ctx);
            index++;
        };


        function randomColorAndRender() {
            setRandomColor();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            render(data, colors, offsetX, offsetY, rectSize, ctx);
        }



        function setRuleSymmetric(seed) {
            for (var i = 0; i < rules.length; i++) {
                rules[i] = 0;
            }
            rules[0] = 1;
            rules[1] = 1;
            var bin = (seed >>> 0).toString(2);
            for (var i = 2; i < bin.length && i < rules.length - 1; i += 2) {
                rules[i] = Number(bin.charAt(i));
                rules[i + 1] = Number(bin.charAt(i));
            }
        }

        function setRandomColor() {

            colors[0] = '#000000';
            for (var i = 1; i < colors.length; i++) {
                colors[i] = decimalToHex(Math.floor(Math.random() * 16777216));
                rulesC[i] = rules[i] * i;
            }
            rulesC[0] = 1;

        }

        function decimalToHex(decimal) {
            const hex = decimal.toString(16).toUpperCase(); // Convert to hexadecimal and make it uppercase
            const paddedHex = hex.padStart(6, '0'); // Pad with zeros to ensure it's 6 characters long
            return '#' + paddedHex;
        }

        function nextStep(cells) {

            var around = new Array(8);
            var cellsUpdate = new Array(WIDTH);
            for (var i = 0; i < WIDTH; i++) {
                cellsUpdate[i] = new Array(HEIGHT);
            }
            for (var x = 1; x < WIDTH - 1; x++) {
                for (var y = 1; y < HEIGHT - 1; y++) {
                    around[0] = cells[x - 1][y - 1];
                    around[1] = cells[x][y - 1];
                    around[2] = cells[x + 1][y - 1];
                    around[3] = cells[x + 1][y];
                    around[4] = cells[x + 1][y + 1];
                    around[5] = cells[x][y + 1];
                    around[6] = cells[x - 1][y + 1];
                    around[7] = cells[x - 1][y];
                    for (var i = 0; i < 8; i++) {
                        if (around[i] != 0) {
                            around[i] = 1;
                        }
                    }
                    cellsUpdate[x][y] = rule(around);
                }
            }
            for (var x = 1; x < WIDTH - 1; x++) {
                for (var y = 1; y < HEIGHT - 1; y++) {
                    cells[x][y] = cellsUpdate[x][y];
                    if (cells[x][y] != 0) {
                        //console.log(x+ " " + y + " - " + cellsUpdate[x][y]);
                    }
                }
            }

        }



        function check(a, b) {
            for (var i = 0; i < a.length; i++) {
                if (a[i] != b[i]) return false;
            }
            return true;
        }

        function check4(a, b) {
            return check(a, [b[0], b[1], b[2], b[3], b[4], b[5], b[6], b[7]]) || check(a, [b[2], b[3], b[4], b[5], b[6], b[7], b[0], b[1]]) || check(a, [b[4], b[5], b[6], b[7], b[0], b[1], b[2], b[3]]) || check(a, [b[6], b[7], b[0], b[1], b[2], b[3], b[4], b[5]]);
        }


        function rule(a) {
            var sum = a[0] + a[1] + a[2] + a[3] + a[4] + a[5] + a[6] + a[7];
            if (sum == 0) return 0;
            if (sum == 1) return rulesC[0];
            if (sum == 2) return rulesC[1];
            if (sum == 3) return rulesC[2];
            if (sum == 4) return rulesC[3];
            if (sum == 5) return rulesC[4];
            if (sum == 6) return rulesC[5];
            if (sum == 7) return rulesC[6];
            return rulesC[7];
        }

        //Sum
        function rule2(a) {
            var sum = a[0] + a[1] + a[2] + a[3] + a[4] + a[5] + a[6] + a[7];
            //NULL
            if (check(a, [0, 0, 0, 0, 0, 0, 0, 0])) return 0;//MUST

            //EINS
            if (check4(a, [1, 0, 0, 0, 0, 0, 0, 0])) return rulesC[0];//MUST oder
            if (check4(a, [0, 1, 0, 0, 0, 0, 0, 0])) return rulesC[1];//MUST


            //ZWEI
            if (check4(a, [1, 1, 0, 0, 0, 0, 0, 0])) return rulesC[2];
            if (check4(a, [0, 1, 1, 0, 0, 0, 0, 0])) return rulesC[3];

            if (check4(a, [1, 0, 1, 0, 0, 0, 0, 0])) return rulesC[4];
            if (check4(a, [0, 1, 0, 1, 0, 0, 0, 0])) return rulesC[5];

            if (check4(a, [1, 0, 0, 1, 0, 0, 0, 0])) return rulesC[6];
            if (check4(a, [0, 1, 0, 0, 1, 0, 0, 0])) return rulesC[7];

            if (check4(a, [1, 0, 0, 0, 1, 0, 0, 0])) return rulesC[8];
            if (check4(a, [0, 1, 0, 0, 0, 1, 0, 0])) return rulesC[9];

            //DREI
            if (check4(a, [1, 1, 1, 0, 0, 0, 0, 0])) return rulesC[10];
            if (check4(a, [0, 1, 1, 1, 0, 0, 0, 0])) return rulesC[11];

            if (check4(a, [1, 1, 0, 1, 0, 0, 0, 0])) return rulesC[12];
            if (check4(a, [0, 1, 1, 0, 1, 0, 0, 0])) return rulesC[13];

            if (check4(a, [1, 1, 0, 0, 1, 0, 0, 0])) return rulesC[14];
            if (check4(a, [0, 1, 1, 0, 0, 1, 0, 0])) return rulesC[15];

            if (check4(a, [1, 1, 0, 0, 0, 1, 0, 0])) return rulesC[16];
            if (check4(a, [0, 1, 1, 0, 0, 0, 1, 0])) return rulesC[17];

            if (check4(a, [1, 1, 0, 0, 0, 0, 1, 0])) return rulesC[18];
            if (check4(a, [0, 1, 1, 0, 0, 0, 0, 1])) return rulesC[19];

            if (check4(a, [1, 0, 1, 0, 1, 0, 0, 0])) return rulesC[20];
            if (check4(a, [0, 1, 0, 1, 0, 1, 0, 0])) return rulesC[21];

            if (check4(a, [1, 0, 1, 0, 0, 1, 0, 0])) return rulesC[22];
            if (check4(a, [0, 1, 0, 1, 0, 0, 1, 0])) return rulesC[23];

            //VIER

            if (check4(a, [1, 1, 1, 1, 0, 0, 0, 0])) return rulesC[24];
            if (check4(a, [0, 1, 1, 1, 1, 0, 0, 0])) return rulesC[25];

            if (check4(a, [1, 1, 1, 0, 1, 0, 0, 0])) return rulesC[26];
            if (check4(a, [0, 1, 1, 1, 0, 1, 0, 0])) return rulesC[27];

            if (check4(a, [1, 1, 1, 0, 0, 1, 0, 0])) return rulesC[28];
            if (check4(a, [0, 1, 1, 1, 0, 0, 1, 0])) return rulesC[29];

            if (check4(a, [1, 1, 1, 0, 0, 0, 1, 0])) return rulesC[30];
            if (check4(a, [0, 1, 1, 1, 0, 0, 0, 1])) return rulesC[31];

            if (check4(a, [1, 1, 0, 1, 1, 0, 0, 0])) return rulesC[32];
            if (check4(a, [0, 1, 1, 0, 1, 1, 0, 0])) return rulesC[33];

            if (check4(a, [1, 1, 0, 1, 0, 1, 0, 0])) return rulesC[34];
            if (check4(a, [0, 1, 1, 0, 1, 0, 1, 0])) return rulesC[35];

            if (check4(a, [1, 1, 0, 1, 0, 0, 1, 0])) return rulesC[36];
            if (check4(a, [0, 1, 1, 0, 1, 0, 0, 1])) return rulesC[37];

            if (check4(a, [1, 1, 0, 0, 1, 0, 1, 0])) return rulesC[38];
            if (check4(a, [0, 1, 1, 0, 0, 1, 0, 1])) return rulesC[39];

            if (check4(a, [1, 1, 0, 0, 1, 1, 0, 0])) return rulesC[40];//2
            if (check4(a, [0, 1, 1, 0, 0, 1, 1, 0])) return rulesC[41];//2

            if (check(a, [1, 0, 1, 0, 1, 0, 1, 0])) return rulesC[42];//1
            if (check(a, [0, 1, 0, 1, 0, 1, 0, 1])) return rulesC[43];//1

            //FÃœNF

            if (check4(a, [0, 0, 0, 1, 1, 1, 1, 1])) return rulesC[44];
            if (check4(a, [0, 0, 0, 1, 1, 1, 1, 1])) return rulesC[45];

            if (check4(a, [0, 0, 1, 0, 1, 1, 1, 1])) return rulesC[46];
            if (check4(a, [1, 0, 0, 1, 0, 1, 1, 1])) return rulesC[47];

            if (check4(a, [0, 0, 1, 1, 0, 1, 1, 1])) return rulesC[48];
            if (check4(a, [1, 0, 0, 1, 1, 0, 1, 1])) return rulesC[49];

            if (check4(a, [0, 0, 1, 1, 1, 0, 1, 1])) return rulesC[50];
            if (check4(a, [1, 0, 0, 1, 1, 1, 0, 1])) return rulesC[51];

            if (check4(a, [0, 0, 1, 1, 1, 1, 0, 1])) return rulesC[52];
            if (check4(a, [1, 0, 0, 1, 1, 1, 1, 0])) return rulesC[53];

            if (check4(a, [0, 1, 0, 1, 0, 1, 1, 1])) return rulesC[54];
            if (check4(a, [1, 0, 1, 0, 1, 0, 1, 1])) return rulesC[55];

            if (check4(a, [0, 1, 0, 1, 1, 0, 1, 1])) return rulesC[56];
            if (check4(a, [1, 0, 1, 0, 1, 1, 0, 1])) return rulesC[57];

            //SECHS
            if (check4(a, [0, 0, 1, 1, 1, 1, 1, 1])) return rulesC[58];
            if (check4(a, [0, 1, 1, 0, 0, 0, 0, 0])) return rulesC[59];

            if (check4(a, [0, 1, 0, 1, 1, 1, 1, 1])) return rulesC[60];
            if (check4(a, [0, 1, 0, 1, 0, 0, 0, 0])) return rulesC[61];

            if (check4(a, [0, 1, 1, 0, 1, 1, 1, 1])) return rulesC[62];
            if (check4(a, [0, 1, 0, 0, 1, 0, 0, 0])) return rulesC[63];

            if (check4(a, [0, 1, 1, 1, 0, 1, 1, 1])) return rulesC[64];
            if (check4(a, [0, 1, 0, 0, 0, 1, 0, 0])) return rulesC[65];

            //SIEBEN
            if (check4(a, [0, 1, 1, 1, 1, 1, 1, 1])) return rulesC[66];
            if (check4(a, [1, 0, 1, 1, 1, 1, 1, 1])) return rulesC[67];

            //ACHT
            if (check(a, [1, 1, 1, 1, 1, 1, 1, 1])) return rulesC[68];
            return 0;
        }






        function render(data, colors, offsetX, offsetY, rectSize, ctx) {
            // Loop through the 2D array and set the pixel colors
            for (let y = 0; y < data.length; y++) {
                for (let x = 0; x < data[y].length; x++) {
                    const colorIndex = data[y][x];
                    const color = colors[colorIndex];
                    ctx.fillStyle = color;
                    ctx.fillRect(offsetX + x * rectSize, offsetY + y * rectSize, rectSize, rectSize);
                    ctx.fillStyle = 'transparent'; // Clear the fillStyle
                }
            }
        }

    </script>
</body>

</html>